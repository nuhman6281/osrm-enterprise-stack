<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OSRM Enhanced API Demo</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
            font-size: 1.1em;
        }
        
        .content {
            padding: 30px;
        }
        
        .demo-section {
            margin-bottom: 40px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background: #fafafa;
        }
        
        .demo-section h3 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: transform 0.2s;
        }
        
        button:hover {
            transform: translateY(-2px);
        }
        
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .result {
            margin-top: 20px;
            padding: 15px;
            background: white;
            border-radius: 6px;
            border-left: 4px solid #667eea;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .error {
            border-left-color: #e74c3c;
            background: #fdf2f2;
            color: #c0392b;
        }
        
        .success {
            border-left-color: #27ae60;
            background: #f2fdf5;
            color: #27ae60;
        }
        
        .map-container {
            height: 400px;
            margin-top: 20px;
            border-radius: 6px;
            overflow: hidden;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }
        
        .stat-label {
            color: #666;
            margin-top: 5px;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .coordinates-input {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .waypoint {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }
        
        .waypoint input {
            flex: 1;
        }
        
        .remove-waypoint {
            background: #e74c3c;
            padding: 8px 12px;
            font-size: 12px;
        }
        
        .add-waypoint {
            background: #27ae60;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üó∫Ô∏è OSRM Enhanced API Demo</h1>
            <p>Comprehensive routing, navigation, and fleet management capabilities</p>
        </div>
        
        <div class="content">
            <!-- Service Status -->
            <div class="demo-section">
                <h3>üîç Service Status</h3>
                <button onclick="checkHealth()">Check Health</button>
                <button onclick="getCacheStats()">Cache Stats</button>
                <button onclick="clearCache()">Clear Cache</button>
                <div id="status-result" class="result" style="display: none;"></div>
            </div>
            
            <!-- Route Calculation -->
            <div class="demo-section">
                <h3>üöó Route Calculation</h3>
                <div id="waypoints-container">
                    <div class="waypoint">
                        <div class="coordinates-input">
                            <input type="number" placeholder="Start Longitude" id="start-lng" value="13.388860" step="any">
                            <input type="number" placeholder="Start Latitude" id="start-lat" value="52.517037" step="any">
                        </div>
                    </div>
                    <div class="waypoint">
                        <div class="coordinates-input">
                            <input type="number" placeholder="End Longitude" id="end-lng" value="13.397634" step="any">
                            <input type="number" placeholder="End Latitude" id="end-lat" value="52.529407" step="any">
                        </div>
                    </div>
                </div>
                <button class="add-waypoint" onclick="addWaypoint()">+ Add Waypoint</button>
                <br><br>
                <button onclick="calculateRoute()">Calculate Route</button>
                <div id="route-result" class="result" style="display: none;"></div>
                <div id="route-map" class="map-container" style="display: none;"></div>
            </div>
            
            <!-- Distance Matrix -->
            <div class="demo-section">
                <h3>üìä Distance Matrix</h3>
                <div class="form-group">
                    <label>Sources (JSON format):</label>
                    <textarea id="matrix-sources" rows="3">[{"lng":13.388860,"lat":52.517037}]</textarea>
                </div>
                <div class="form-group">
                    <label>Destinations (JSON format):</label>
                    <textarea id="matrix-destinations" rows="3">[{"lng":13.397634,"lat":52.529407},{"lng":13.428555,"lat":52.523219}]</textarea>
                </div>
                <button onclick="calculateMatrix()">Calculate Matrix</button>
                <div id="matrix-result" class="result" style="display: none;"></div>
            </div>
            
            <!-- Trip Optimization -->
            <div class="demo-section">
                <h3>üéØ Trip Optimization</h3>
                <div class="form-group">
                    <label>Waypoints (JSON format):</label>
                    <textarea id="trip-waypoints" rows="4">[
  {"lng":13.388860,"lat":52.517037},
  {"lng":13.397634,"lat":52.529407},
  {"lng":13.428555,"lat":52.523219}
]</textarea>
                </div>
                <button onclick="optimizeTrip()">Optimize Trip</button>
                <div id="trip-result" class="result" style="display: none;"></div>
            </div>
            
            <!-- Nearest Roads -->
            <div class="demo-section">
                <h3>üõ£Ô∏è Find Nearest Roads</h3>
                <div class="coordinates-input">
                    <input type="number" placeholder="Longitude" id="nearest-lng" value="13.388860" step="any">
                    <input type="number" placeholder="Latitude" id="nearest-lat" value="52.517037" step="any">
                </div>
                <br>
                <button onclick="findNearest()">Find Nearest</button>
                <div id="nearest-result" class="result" style="display: none;"></div>
            </div>
            
            <!-- Isochrone -->
            <div class="demo-section">
                <h3>‚è±Ô∏è Isochrone Analysis</h3>
                <div class="coordinates-input">
                    <input type="number" placeholder="Center Longitude" id="iso-lng" value="13.388860" step="any">
                    <input type="number" placeholder="Center Latitude" id="iso-lat" value="52.517037" step="any">
                </div>
                <br>
                <div class="form-group">
                    <label>Time Limits (seconds, comma-separated):</label>
                    <input type="text" id="time-limits" value="300,600,900">
                </div>
                <button onclick="generateIsochrone()">Generate Isochrone</button>
                <div id="isochrone-result" class="result" style="display: none;"></div>
            </div>
        </div>
    </div>

    <!-- Include Leaflet for maps -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <!-- Include our OSRM client -->
    <script src="../client/osrm-client.js"></script>
    
    <script>
        // Initialize OSRM client
        const client = new OSRMClient({
            baseUrl: 'http://localhost:3001',
            timeout: 30000
        });
        
        let routeMap = null;
        let waypoints = [];
        
        // Utility functions
        function showResult(elementId, data, isError = false) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = `result ${isError ? 'error' : 'success'}`;
            element.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
        }
        
        function showLoading(button) {
            button.disabled = true;
            button.innerHTML = '<span class="loading"></span>' + button.textContent;
        }
        
        function hideLoading(button, originalText) {
            button.disabled = false;
            button.innerHTML = originalText;
        }
        
        // Service status functions
        async function checkHealth() {
            const button = event.target;
            const originalText = button.textContent;
            showLoading(button);
            
            try {
                const health = await client.getHealth();
                showResult('status-result', health);
            } catch (error) {
                showResult('status-result', { error: error.message }, true);
            } finally {
                hideLoading(button, originalText);
            }
        }
        
        async function getCacheStats() {
            const button = event.target;
            const originalText = button.textContent;
            showLoading(button);
            
            try {
                const stats = await client.getCacheStats();
                showResult('status-result', stats);
            } catch (error) {
                showResult('status-result', { error: error.message }, true);
            } finally {
                hideLoading(button, originalText);
            }
        }
        
        async function clearCache() {
            const button = event.target;
            const originalText = button.textContent;
            showLoading(button);
            
            try {
                const result = await client.clearCache();
                showResult('status-result', result);
            } catch (error) {
                showResult('status-result', { error: error.message }, true);
            } finally {
                hideLoading(button, originalText);
            }
        }
        
        // Route calculation
        function addWaypoint() {
            const container = document.getElementById('waypoints-container');
            const waypointDiv = document.createElement('div');
            waypointDiv.className = 'waypoint';
            waypointDiv.innerHTML = `
                <div class="coordinates-input">
                    <input type="number" placeholder="Longitude" step="any">
                    <input type="number" placeholder="Latitude" step="any">
                </div>
                <button class="remove-waypoint" onclick="removeWaypoint(this)">Remove</button>
            `;
            container.appendChild(waypointDiv);
        }
        
        function removeWaypoint(button) {
            button.parentElement.remove();
        }
        
        function getWaypoints() {
            const waypointElements = document.querySelectorAll('.waypoint');
            const waypoints = [];
            
            waypointElements.forEach(element => {
                const inputs = element.querySelectorAll('input');
                if (inputs.length >= 2) {
                    const lng = parseFloat(inputs[0].value);
                    const lat = parseFloat(inputs[1].value);
                    if (!isNaN(lng) && !isNaN(lat)) {
                        waypoints.push({ lng, lat });
                    }
                }
            });
            
            return waypoints;
        }
        
        async function calculateRoute() {
            const button = event.target;
            const originalText = button.textContent;
            showLoading(button);
            
            try {
                const waypoints = getWaypoints();
                if (waypoints.length < 2) {
                    throw new Error('At least 2 waypoints are required');
                }
                
                const route = await client.getRoute(waypoints, {
                    steps: true,
                    overview: 'full'
                });
                
                showResult('route-result', route);
                displayRouteOnMap(route, waypoints);
            } catch (error) {
                showResult('route-result', { error: error.message }, true);
            } finally {
                hideLoading(button, originalText);
            }
        }
        
        function displayRouteOnMap(route, waypoints) {
            const mapContainer = document.getElementById('route-map');
            mapContainer.style.display = 'block';
            
            if (routeMap) {
                routeMap.remove();
            }
            
            routeMap = L.map('route-map').setView([waypoints[0].lat, waypoints[0].lng], 13);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors'
            }).addTo(routeMap);
            
            // Add waypoint markers
            waypoints.forEach((waypoint, index) => {
                L.marker([waypoint.lat, waypoint.lng])
                    .addTo(routeMap)
                    .bindPopup(`Waypoint ${index + 1}`);
            });
            
            // Add route line if available
            if (route.routes && route.routes[0] && route.routes[0].geometry) {
                const coordinates = OSRMUtils.decodePolyline(route.routes[0].geometry);
                const latLngs = coordinates.map(coord => [coord.lat, coord.lng]);
                
                L.polyline(latLngs, { color: 'blue', weight: 5 }).addTo(routeMap);
                
                // Fit map to route bounds
                const group = new L.featureGroup([
                    ...waypoints.map(wp => L.marker([wp.lat, wp.lng])),
                    L.polyline(latLngs)
                ]);
                routeMap.fitBounds(group.getBounds().pad(0.1));
            }
        }
        
        // Distance matrix calculation
        async function calculateMatrix() {
            const button = event.target;
            const originalText = button.textContent;
            showLoading(button);
            
            try {
                const sources = JSON.parse(document.getElementById('matrix-sources').value);
                const destinations = JSON.parse(document.getElementById('matrix-destinations').value);
                
                const matrix = await client.getMatrix(sources, destinations);
                showResult('matrix-result', matrix);
            } catch (error) {
                showResult('matrix-result', { error: error.message }, true);
            } finally {
                hideLoading(button, originalText);
            }
        }
        
        // Trip optimization
        async function optimizeTrip() {
            const button = event.target;
            const originalText = button.textContent;
            showLoading(button);
            
            try {
                const waypoints = JSON.parse(document.getElementById('trip-waypoints').value);
                const trip = await client.optimizeTrip(waypoints);
                showResult('trip-result', trip);
            } catch (error) {
                showResult('trip-result', { error: error.message }, true);
            } finally {
                hideLoading(button, originalText);
            }
        }
        
        // Find nearest roads
        async function findNearest() {
            const button = event.target;
            const originalText = button.textContent;
            showLoading(button);
            
            try {
                const lng = parseFloat(document.getElementById('nearest-lng').value);
                const lat = parseFloat(document.getElementById('nearest-lat').value);
                
                const nearest = await client.findNearest({ lng, lat });
                showResult('nearest-result', nearest);
            } catch (error) {
                showResult('nearest-result', { error: error.message }, true);
            } finally {
                hideLoading(button, originalText);
            }
        }
        
        // Generate isochrone
        async function generateIsochrone() {
            const button = event.target;
            const originalText = button.textContent;
            showLoading(button);
            
            try {
                const lng = parseFloat(document.getElementById('iso-lng').value);
                const lat = parseFloat(document.getElementById('iso-lat').value);
                const timeLimits = document.getElementById('time-limits').value
                    .split(',')
                    .map(t => parseInt(t.trim()));
                
                const isochrone = await client.getIsochrone({ lng, lat }, timeLimits);
                showResult('isochrone-result', isochrone);
            } catch (error) {
                showResult('isochrone-result', { error: error.message }, true);
            } finally {
                hideLoading(button, originalText);
            }
        }
        
        // Initialize demo with some default values
        document.addEventListener('DOMContentLoaded', function() {
            console.log('OSRM Enhanced API Demo loaded');
            console.log('Client initialized:', client);
        });
    </script>
</body>
</html> 